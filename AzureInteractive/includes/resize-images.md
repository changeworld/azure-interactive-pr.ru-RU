---
title: включение файла
description: включение файла
services: functions
author: ggailey777
manager: jeconnoc
ms.service: multiple
ms.topic: include
ms.date: 06/21/2018
ms.author: glenga
ms.custom: include file
ms.openlocfilehash: d19a9d0e7e0347b38fc16f85fa440281be5347f2
ms.sourcegitcommit: 81587470a181e314242c7a97cd0f91c82d4fe232
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47460093"
---
Из предыдущего модуля вы узнали, как с помощью бессерверной функции упростить безопасную отправку изображений из веб-приложения в хранилище BLOB-объектов. В этом модуле вы создадите другую бессерверную функцию, которая позволяет просматривать изображения и создавать из них эскизы.

## <a name="create-a-blob-storage-container-for-thumbnails"></a>Создание контейнера хранилища BLOB-объектов для эскизов

Полноразмерные изображения хранятся в контейнере с именем **images**. Для хранения эскизов этих изображений вам потребуется другой контейнер.

1. Убедитесь, что окно Cloud Shell (Bash) открыто.  Если вы уже вышли, выберите **Enter focus mode** (Перейти в режим фокусировки), чтобы открыть окно Cloud Shell. 

1. Создайте в своей учетной записи хранения контейнер с именем **thumbnails** с общим доступом ко всем большим двоичным объектам.

    ```azurecli
    az storage container create -n thumbnails --account-name <storage account name> --public-access blob
    ```


## <a name="create-a-blob-triggered-serverless-function"></a>Создание бессерверной функции, активируемой большим двоичным объектом

Триггер определяет способ вызова функции. Функция, которую вы создадите, использует триггер больших двоичных объектов: она автоматически вызывается при отправке большого двоичного объекта (файл изображения) в контейнер **images**. У функции должен быть один триггер. С триггерами могут быть связанны данные, которые обычно являются полезными и активируют функцию.

Привязки определяют, как функция считывает или записывает данные в Azure или сторонних службах. Для функции создается эскиз изображения, при отправке которого она активируется. Этот эскиз сохраняется в контейнер *thumbnails*.

1. Откройте приложение-функцию на портале Azure.

1. В окне приложения-функции наведите указатель мыши на элемент **Функции** в области навигации слева и нажмите кнопку **+**, чтобы приступить к созданию бессерверной функции. Когда появится страница быстрого запуска, щелкните **Пользовательская функция**, чтобы просмотреть список шаблонов функций.

1. Найдите и выберите шаблон **BlobTrigger**.

1. Введите указанные ниже значения, чтобы создать функцию, которая создает эскизы при отправке изображений.

    | Параметр      |  Рекомендуемое значение   | ОПИСАНИЕ                                        |
    | --- | --- | ---|
    | **Язык** | C# или JavaScript | Выберите предпочитаемый язык. |
    | **Имя функции** | ResizeImage | Введите это имя именно так, как показано, чтобы приложение смогло обнаружить функцию. |
    | **Путь** | images/{name} | Функция выполняется при появлении файла в контейнере **images**. |
    | **Сведения об учетной записи хранения** | AZURE_STORAGE_CONNECTION_STRING | Используйте переменную среды, созданную ранее вместе со строкой подключения. |

    ![Ввод параметров для новой функции](media/functions-first-serverless-web-app/3-new-function.png)

1. Щелкните **Создать**, чтобы создать функцию.

1. Когда функция будет создана, щелкните **Интегрировать**, чтобы просмотреть триггер, а также входные и выходные привязки функции.

1. Чтобы создать выходную привязку, щелкните **Новое выходное значение**.

    ![Выбор элемента "Новое выходное значение" на вкладке "Интегрировать"](media/functions-first-serverless-web-app/3-new-output.jpg)

1. Выберите **Хранилище BLOB-объектов Azure** и щелкните **Выбрать**. Возможно, потребуется прокрутить экран вниз, чтобы отобразилась кнопка **Выбрать**.

    ![Выбор элемента "Хранилище BLOB-объектов Azure"](media/functions-first-serverless-web-app/3-storage-output.jpg)

1. Введите указанные ниже значения.

    | Параметр      |  Рекомендуемое значение   | ОПИСАНИЕ                                        |
    | --- | --- | ---|
    | **Имя параметра большого двоичного объекта** | thumbnail | Функция использует параметр с таким именем для записи эскиза. |
    | **Использовать возвращаемое значение функции** | Нет  |  |
    | **Путь** | thumbnails/{name} | Эскизы записываются в контейнер с именем **thumbnails**. |
    | **Подключение к учетной записи хранения** | AZURE_STORAGE_CONNECTION_STRING | Используйте переменную среды, созданную ранее вместе со строкой подключения. |

    ![Ввод параметров для выходной привязки BLOB-объекта](media/functions-first-serverless-web-app/3-blob-output.png)

1. **JavaScript**

    1. (JavaScript) Щелкните **Расширенный редактор** в правом верхнем углу окна, чтобы открыть документ JSON с привязками.

    1. (JavaScript) В разделе привязки `blobTrigger` добавьте свойство с именем `dataType` и значением `binary`. Таким образом вы зададите конфигурацию для привязки, чтобы отправлять содержимое большого двоичного объекта в функцию в виде двоичных данных.

    ```json
    {
      "name": "myBlob",
      "type": "blobTrigger",
      "direction": "in",
      "path": "images/{name}",
      "connection": "AZURE_STORAGE_CONNECTION_STRING",
      "dataType": "binary"
    }
    ```

1. Нажмите кнопку **Сохранить**, чтобы создать привязку.

1. **C#**

    1. (C#) Щелкните имя функции **ResizeImage** в области навигации слева, чтобы открыть исходный код функции.

    1. (C#) Для создания эскизов функции требуется пакет NuGet с именем **ImageResizer**. Пакеты NuGet добавляются в функции C# с помощью файла **project.json**. Чтобы создать такой файл, щелкните **Просмотреть файлы** справа. Откроются файлы, из которых состоит функция.
    
    1. (C#) Чтобы добавить новый файл с именем **project.json**, нажмите кнопку **Добавить**.
    
    1. (C#) Скопируйте содержимое из репозитория [**/csharp/ResizeImage/project.json**](https://raw.githubusercontent.com/Azure-Samples/functions-first-serverless-web-application/master/csharp/ResizeImage/project.json) в только что созданный файл. Сохраните файл. Пакеты автоматически восстанавливаются при обновлении файла.
    
        ![Файл project.json с указанным пакетом ImageResizer](media/functions-first-serverless-web-app/3-project-json.png)
    
    1. (C#) Выберите файл **run.csx** в разделе **Просмотреть файлы** и замените его содержимое содержимым из репозитория [**/csharp/ResizeImage/run.csx**](https://raw.githubusercontent.com/Azure-Samples/functions-first-serverless-web-application/master/csharp/ResizeImage/run.csx).

1. **JavaScript** 

    1. (JavaScript) Чтобы изменить размер фотографии, этой функции требуется пакет `jimp` из npm. Чтобы установить пакет npm, щелкните имя приложения-функции в области навигации слева и выберите **Функции платформы**.

    1. (JavaScript) Чтобы открыть окно консоли, щелкните **Консоль**.

    1. (JavaScript) В консоли выполните команду `npm install jimp`. Выполнение операции может занять одну-две минуты.

    1. (JavaScript) Щелкните имя функции **ResizeImage** в области навигации слева, чтобы открыть окно с ее кодом. Замените содержимое файла **index.js** содержимым из репозитория [**/javascript/ResizeImage/index.js**](https://raw.githubusercontent.com/Azure-Samples/functions-first-serverless-web-application/master/javascript/ResizeImage/index.js).

1. Щелкните **Журналы** под окном кода, чтобы развернуть панель журналов.

1. Выберите команду **Сохранить**. Просмотрите записи на панели журналов и проверьте, успешно ли сохранена функция и нет ли ошибок.


## <a name="test-the-serverless-function"></a>Тестирование бессерверной функции

1. Откройте приложение в браузере. Выберите файл изображения и отправьте его. Отправка завершится, но, так как мы еще не добавили возможность выводить изображения, в приложении не отобразится отправленная фотография.

1. В Cloud Shell проверьте, отправлено ли изображение в контейнер **images**.

    ```azurecli
    az storage blob list --account-name <storage account name> -c images -o table
    ```

1. Убедитесь, что эскиз создан в контейнере с именем **thumbnails**.

    ```azurecli
    az storage blob list --account-name <storage account name> -c thumbnails -o table
    ```

1. Получите URL-адрес эскиза.

    ```azurecli
    az storage blob url --account-name <storage account name> -c thumbnails -n <filename> --output tsv
    ```

    Откройте URL-адрес в браузере и убедитесь, что эскиз создан правильно.

1. Прежде чем перейти к следующему руководству, удалите все файлы в контейнерах **images** и **thumbnails**.

    ```azurecli
    az storage blob delete-batch -s images --account-name <storage account name>
    ```
    ```azurecli
    az storage blob delete-batch -s thumbnails --account-name <storage account name>
    ```


## <a name="summary"></a>Сводка

В этом модуле вы создали бессерверную функцию, которая создает эскиз при отправке изображения в контейнер хранилища BLOB-объектов. Далее вы узнаете, как использовать Azure Cosmos DB для хранения и вывода списка метаданных изображения.
