---
title: включение файла
description: включение файла
services: functions
author: ggailey777
manager: jeconnoc
ms.service: multiple
ms.topic: include
ms.date: 06/21/2018
ms.author: glenga
ms.custom: include file
ms.openlocfilehash: 194a25dbf9abda80379aa5aab408ac4ffe9ab7f5
ms.sourcegitcommit: 81587470a181e314242c7a97cd0f91c82d4fe232
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/01/2018
ms.locfileid: "47460064"
---
Azure Cosmos DB — это глобально распределенная бессерверная многомодельная база данных Майкрософт. Из этого модуля вы узнаете, как с помощью службы "Функции Azure" сохранять и извлекать метаданные изображений в виде документов JSON в Cosmos DB.

## <a name="create-a-cosmos-db-account-database-and-collection"></a>Создание базы данных, коллекции и у четной записи Cosmos DB

Учетная запись Cosmos DB — это ресурс Azure, который содержит базы данных Cosmos DB.

1. Убедитесь, что окно Cloud Shell открыто.  Если вы уже вышли, выберите **Enter focus mode** (Перейти в режим фокусировки), чтобы открыть окно Cloud Shell. 

1. Создайте учетную запись Cosmos DB с уникальным именем в той же группе ресурсов, где хранятся другие ресурсы, созданные при работе с этим руководством.

    ```azurecli
    az cosmosdb create -g first-serverless-app -n <cosmos db account name>
    ```

1. Создав учетную запись Cosmos DB, создайте в ней базу данных с именем **imagesdb**.

    ```azurecli
    az cosmosdb database create -g first-serverless-app -n <cosmos db account name> --db-name imagesdb
    ```

1. Когда база данных будет создана, создайте в ней коллекцию с именем **images** и пропускной способностью 400 единиц запросов (ЕЗ).

    ```azurecli
    az cosmosdb collection create -g first-serverless-app -n <cosmos db account name> --db-name imagesdb --collection-name images --throughput 400
    ```


## <a name="save-a-document-to-cosmos-db-when-a-thumbnail-is-created"></a>Сохранение документа в Cosmos DB при создании эскиза

Выходная привязка Cosmos DB позволяет создавать документы в коллекции Cosmos DB из службы "Функции Azure". На следующих этапах вы настроите выходную привязку Cosmos DB в функции **ResizeImage** и измените функцию, чтобы она возвращала документ (объект) для сохранения.

1. Откройте приложение-функцию на портале Azure.

1. В области навигации слева разверните узел функции **ResizeImage** и выберите **Интегрировать**.

1. В разделе **Выходные данные** щелкните **Новое выходное значение**.

1. Найдите и выберите элемент **Azure Cosmos DB**. Затем щелкните **Выбрать**.

    ![Выбор элемента "Новое выходное значение"](media/functions-first-serverless-web-app/4-new-output.jpg)

1. Заполните поля в разделе **Azure Cosmos DB output** (Выходные данные Azure Cosmos DB) указанными ниже значениями.

    | Параметр      |  Рекомендуемое значение   | ОПИСАНИЕ                                        |
    | --- | --- | ---|
    | **Имя параметра документа** | Выберите **Использовать возвращаемое значение функции**. | В текстовом поле автоматически указывается значение **$return**. |
    | **Database name** (Имя базы данных) | imagesdb | Используйте имя созданной вами базы данных. |
    | **Имя коллекции** | images | Используйте имя созданной вами коллекции. |

1. Рядом с элементом **Подключение учетной записи Azure Cosmos DB** щелкните ссылку **Создать**. Выберите учетную запись Cosmos DB, которую вы создали ранее.

    ![Ввод параметров для выходной привязки Azure Cosmos DB](media/functions-first-serverless-web-app/4-cosmos-db-output.png)

1. Нажмите кнопку **Сохранить**, чтобы создать выходную привязку Cosmos DB.

1. Щелкните имя функции **ResizeImage** слева, чтобы открыть функцию.

1. **C#**

    1. (C#) Измените тип возвращаемого значения функции с **void** на **object**.

    1. (C#) В конец функции добавьте следующий блок кода, чтобы она возвращала сохраняемый документ:
    
        ```csharp
        return new {
            id = name,
            imgPath = "/images/" + name,
            thumbnailPath = "/thumbnails/" + name
        };
        ```
    
        ![Измененный файл run.csx для функции ResizeImages](media/functions-first-serverless-web-app/4-update-function.png)

1. **JavaScript**

    1. (JavaScript) Измените инструкцию `context.done()` в предложении `else`, чтобы возвращался документ, сохраняемый в Cosmos DB.

    ```javascript
    if (error) {
        context.done(error);
    } else {
        context.bindings.thumbnail = stream;
        context.done(null, {
            id: context.bindingData.name,
            imgPath: "/images/" + context.bindingData.name,
            thumbnailPath: "/thumbnails/" + context.bindingData.name
        });
    }
    ```

1. Щелкните **Журналы** под окном кода, чтобы развернуть панель журналов.

1. Выберите команду **Сохранить**. Просмотрите записи на панели журналов и проверьте, успешно ли сохранена функция и нет ли ошибок.


## <a name="create-a-function-to-list-images-from-cosmos-db"></a>Создание функции для получения списка изображений из Cosmos DB

Чтобы получать метаданные изображения из Cosmos DB, веб-приложению требуется API. На следующих этапах вы создадите функцию, активируемую HTTP-запросом, которая использует входную привязку Cosmos DB, чтобы запросить коллекцию базы данных.

1. В приложении-функции наведите указатель мыши на элемент **Функции** слева и щелкните **+**, чтобы создать функцию.

1. Найдите и выберите шаблон **HttpTrigger**.

1. Задайте указанные ниже значения, чтобы создать функцию, которая генерирует URL-адрес для получения изображений.

    | Параметр      |  Рекомендуемое значение   | ОПИСАНИЕ                                        |
    | --- | --- | ---|
    | **Имя функции** | GetImages | Введите это имя именно так, как показано, чтобы приложение смогло обнаружить функцию. |
    | **Уровень авторизации** | Анонимные | Предоставьте общий доступ к функции. |

1. Нажмите кнопку **Создать**.

1. Создав функцию, щелкните **Интегрировать** под ее именем в области навигации слева.

1. Выберите **Новое входное значение** и **Azure Cosmos DB**. 

    ![Выбор элемента "Новое входное значение"](media/functions-first-serverless-web-app/4-new-input.jpg)

1. Нажмите кнопку **Выбрать**.

1. Введите следующие значения:

    | Параметр      |  Рекомендуемое значение   | ОПИСАНИЕ                                        |
    | --- | --- | ---|
    | **Имя параметра документа** | documents | Совпадает с именем параметра в функции. |
    | **Database name** (Имя базы данных) | imagesdb |  |
    | **Имя коллекции** | images |  |
    | **SQL query** | select * from c order by c._ts desc | Получение документов. Сначала вы получите документы, которые были созданы последними. |
    | **Подключение учетной записи Azure Cosmos DB** | Выберите существующую строку подключения. |  |

1. Нажмите кнопку **Сохранить**, чтобы создать входную привязку.

1. **C#**

    1. Щелкните имя функции, чтобы открыть окно кода, а затем замените содержимое файла **run.csx** содержимым из репозитория [**/csharp/GetImages/run.csx**](https://raw.githubusercontent.com/Azure-Samples/functions-first-serverless-web-application/master/csharp/GetImages/run.csx).

1. **JavaScript**

    1. Щелкните имя функции, чтобы открыть окно кода, а затем замените содержимое файла **index.js** содержимым из репозитория [**/javascript/GetImages/index.js**](https://raw.githubusercontent.com/Azure-Samples/functions-first-serverless-web-application/master/javascript/GetImages/index.js).

1. Щелкните **Журналы** под окном кода, чтобы развернуть панель журналов.

1. Выберите команду **Сохранить**. Просмотрите записи на панели журналов и проверьте, успешно ли сохранена функция и нет ли ошибок.


## <a name="test-the-application"></a>Тестирование приложения

1. Откройте приложение в браузере. Выберите файл изображения и отправьте его.

1. Через несколько секунд на странице появится эскиз нового изображения.

1. На портале Azure используйте поле поиска, чтобы найти учетную запись Cosmos DB по имени. Щелкните ее, чтобы открыть.

1. Выберите **обозреватель данных** слева, чтобы просмотреть коллекции и документы.

1. В разделе базы данных **imagesdb** выберите коллекцию **images**.

1. Проверьте, создан ли документ для отправленного изображения.

    ![Обозреватель данных, в котором показан документ для отправленного изображения](media/functions-first-serverless-web-app/4-data-explorer.png)



## <a name="summary"></a>Сводка

Из этого модуля вы узнали, как создать учетную запись, базу данных и коллекцию Cosmos DB. Также вы научились сохранять и извлекать метаданные изображения в коллекции Cosmos DB, используя привязки Cosmos DB. Далее вы узнаете, как с помощью Microsoft Cognitive Services автоматически создавать подписи для каждого отправленного изображения.
